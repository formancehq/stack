input:
  event_bus:
    topic: audit
    consumer_group: search-audit

pipeline:
  processors:
  - log:
      message: "receive message: ${! this }"
  - switch_event_type:
      events:
      - label: AUDIT
        processors:
        - bloblang: |
            meta id = "AUDIT-%s".format(this.payload.id)
            meta action = "index"
            
            root = {
              "data": this.payload,
              "indexed": {
                "requestPath": this.payload.request.path,
                "requestMethod": this.payload.request.method,
                "responseStatusCode": this.payload.response.status_code,
              },
              "kind": "AUDIT",
              "when": this.date
            }


output:
  resource: elasticsearch
