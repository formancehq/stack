---
title: Upgrade management
---

<!-- ## Releases notification -->

When self-hosting a Formance deployment, you are in charge of managing the upgrade process of your deployment. The operator has been designed to make this process as smooth as possible, but there are still a few things to keep in mind when upgrading your deployment which we will cover in this section.

:::info
Make sure to check the [release notes](https://github.com/formancehq/stack/releases) of the version you are upgrading to, as they may contain important information regarding the upgrade process.
:::

## Upgrade process

### Operator upgrade

The first thing to do when you are headed towards upgrading your Formance deployment is to upgrade the operator. As the one in charge of managing the whole deployment, having an up to date operator will guarantee that it is able to manage the latest versions of the components it will be in charge of deploying.

The operator can be upgraded with Helm, following the instructions in the dedicated operator upgrade [section](/operator/upgrade).

Once your operator is up to date, you can move on to upgrading the components of your deployment themselves.

### Components upgrade

The upgrade process is handled by the operator, which will take care of upgrading the components one by one, as per specified in the `versions` CRD. Any migration that needs to be performed will be handled by the operator as well.

As a result, the primary action on your side is to update the `versions` CRD to the version you want to upgrade to. The operator will then take care of the rest. The following command can be used to update the `versions` CRD:

```bash
kubectl edit stack stack1
```

You can find the latest assemblage of components versions in the list of the [versions CRD](/reference/crds/versions).

:::warning
Do not update the versions CRD unless you are ready to upgrade your deployment.
:::

Once updated, the operator will start the upgrade process. You can follow the process in the `status` section of the `stack` CRD. The status will be updated in real time, and will indicate the health status of the various services, such as whether they are `healthy` or not.

For each component, a [rolling upgrade](https://kubernetes.io/docs/tutorials/kubernetes-basics/update/update-intro/) will be performed, meaning that the component will be upgraded one by one, and the service will be kept running during the upgrade process.

:::info
Note that the rollout process is managed by Kubernetes, and as such, the operator has no control over it. As a result, the upgrade process may be interrupted by Kubernetes, and a service may be unavailable for a short period of time.
:::


<!-- - How do I upgrade
    - Upgrading the operator
    - Upgrading the versions CRD -->

<!-- Status Tracking in CRD Stack: In each stack created, there's a 'status' section that provides information on the current state of the document. It indicates the health status of various services, such as whether they are 'healthy' or not.

Real-Time Status Updates: The status is updated in real time. All services transition to a 'healthy' state as migrations are performed. This continues until the final status of 'stack healthy' is reached, signifying that the entire system has been migrated and is operational.

Status Change Dynamics: If a component (e.g., the Ledger pod) is deleted, its status automatically reverts to 'unhealthy' until it returns to a 'healthy' state.

Handling Unhealthy Status: When a service remains 'unhealthy', the system tries to maintain its previous state until the new state is successfully achieved. This is not an exact science, especially during migrations.

Migration Process: During migrations, certain container types like Payment and Ledger require no ongoing writes. This necessitates splitting read and write operations into different series, temporarily shutting down writes during migration.

Upcoming Improvements in Version 2: The next version aims to allow adding or removing columns over three versions. This will enable adding a column not used for reading but available for writing, facilitating updates with limited downtime.

Operational Impact: Updates can either proceed smoothly or may require scheduling due to potential service interruptions. It's vital to assume that maintenance will occur, planned and tested in advance, rather than expecting seamless updates.

Update Management: As organizations have control over when to apply updates, it's best to prepare for temporary service disruptions during updates. The principle is to expect disruptions, though it might not always happen.

Legal and Operational Considerations: There are potential legal and operational constraints, especially if continuous operation is mandated. Users might need to be notified of any planned service interruptions.

Testing and Staging: Any changes should be thoroughly tested in a staging environment before deployment to ensure functionality.

Service Availability During Updates: Normally, a progressive rollout is implemented to avoid complete service downtime. However, unexpected issues can arise, such as Kubernetes deciding to drop containers, which might affect service availability.

 -->

<!-- You have the ability to upgrade when you want

Comment suivre le process après mise à jour

Dans le CRD stack 

Partie status; informations sur l’état du déploiement en cours

Est-ce que ça va le faire instant?

En temps réel; ils passent tous en unhealthy et redeviennent tous en healthy quand le process est terminé

Que faire si reste bloqué en unhealthy ⇒ ça dépend

Kube garde l’état précédent tant que le nouvel état est prêt

En fonction des cas; des migrations vont être requises and will need to stop writes

Which is why we split services

On shutdown le write while data is migrated

Partir du principe que les writes can be stopped or something bad can happen

Normalement we ask kube to do rollout deployments

That being said, we are subject to kube execution of the deployment and interruptions can happen even if not planned

All upgrades should be thoroughly rehearsed on a non production environment -->