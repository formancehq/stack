
# https://taskfile.dev
version: "3"

env:
  VERSION: "develop"

tasks:
  install:
    desc: Install all dependencies
    cmds:
      - yarn install
  build:
    desc: Build the project
    cmds:
      - yarn run build
    deps:
      - install
  sdk:generate:
    desc: Generate client code
    dir: ./sdk
    preconditions:
      - sh: '[ "{{.CLI_ARGS}}" != "" ]'
        msg: Please specify generator as first cli arg (ie "task generate -- go")
    cmds:
      - >
        docker run --rm -w /local -v ${PWD}:/local openapitools/openapi-generator-cli:latest generate
        -i ./generate.json
        -g {{ (split "-" .CLI_ARGS)._0 }}
        -c ./configs/{{.CLI_ARGS}}.yaml
        -o ./sdks/{{.CLI_ARGS}}
        --git-user-id=formancehq
        --git-repo-id=formance-sdk-{{.CLI_ARGS}}
        -p packageVersion={{.VERSION}}
    deps:
      - build
  sdk:generate:all:
    desc: Generate all client code
    dir: ./sdk
    cmds:
      - task: sdk:generate
        vars: {CLI_ARGS: "go", VERSION: "{{.VERSION}}"}
      - task: sdk:generate
        vars: {CLI_ARGS: "java", VERSION: "{{.VERSION}}"}
      - task: sdk:generate
        vars: {CLI_ARGS: "php", VERSION: "{{.VERSION}}"}
      - task: sdk:generate
        vars: {CLI_ARGS: "python", VERSION: "{{.VERSION}}"}
      - task: sdk:generate
        vars: {CLI_ARGS: "typescript-node", VERSION: "{{.VERSION}}"}
    deps:
      - build